# Appium JS Tests

–ù–∞–±–æ—Ä –º–æ–±–∏–ª—å–Ω—ã—Ö –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤ (WebdriverIO + Appium + Allure).

## –ó–∞–ø—É—Å–∫

–õ–æ–∫–∞–ª—å–Ω–æ (—ç–º—É–ª—è—Ç–æ—Ä –∏–ª–∏ —Ä–µ–∞–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ):

```
npm run test:local
```

CI –ø—Ä–æ–≥–æ–Ω (–ø—Ä–∏–º–µ—Ä Jenkins):

```
APPIUM_PORT=4724 npm run test:ci
```

## –û—Å–Ω–æ–≤–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

| –°–∫—Ä–∏–ø—Ç                    | –û–ø–∏—Å–∞–Ω–∏–µ                                                        |
| ------------------------- | --------------------------------------------------------------- |
| `npm run test`            | –ó–∞–ø—É—Å–∫ WDIO (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç `wdio.conf.ts`)                         |
| `npm run test:local`      | –û—á–∏—Å—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –æ—Ç–∫—Ä—ã—Ç–∏–µ Allure |
| `npm run test:ci`         | –û—á–∏—Å—Ç–∫–∞, –∑–∞–ø—É—Å–∫, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞ (–±–µ–∑ –æ—Ç–∫—Ä—ã—Ç–∏—è –±—Ä–∞—É–∑–µ—Ä–∞)       |
| `npm run allure:clean`    | –£–¥–∞–ª–∏—Ç—å `allure-results` –∏ `allure-report`                      |
| `npm run allure:generate` | –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç                                             |
| `npm run allure:open`     | –û—Ç–∫—Ä—ã—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ Allure –æ—Ç—á—ë—Ç                                   |

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (ENV)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è                | –ó–Ω–∞—á–µ–Ω–∏–µ / –§–æ—Ä–º–∞—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                                                                                                              | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é                   |
| ------------------------- | ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------ |
| `REAL_DEVICE`             | `true/false`      | (Override) –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á–∏—Ç—å (`true`) –∏–ª–∏ –≤—ã–∫–ª—é—á–∏—Ç—å (`false`) –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞. –ï—Å–ª–∏ –ù–ï –∑–∞–¥–∞–Ω–∞ ‚Äì –≤–∫–ª—é—á—ë–Ω –∞–≤—Ç–æ–¥–µ—Ç–µ–∫—Ç (—Å–º. –Ω–∏–∂–µ).  | (–∞–≤—Ç–æ–¥–µ—Ç–µ–∫—Ç)                   |
| `UDID`                    | –°—Ç—Ä–æ–∫–∞            | –Ø–≤–Ω—ã–π UDID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (fallback)                                                                                                                        | -                              |
| `DEVICE_NAME`             | –°—Ç—Ä–æ–∫–∞            | –ù–∞–∑–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ –æ—Ç—á—ë—Ç–µ/–∫–∞–ø–∞—Ö                                                                                                                      | emulator-5554 / real_device    |
| `PLATFORM_VERSION`        | –í–µ—Ä—Å–∏—è Android    | –Ø–≤–Ω–æ –∑–∞–¥–∞—Ç—å –≤–µ—Ä—Å–∏—é (–∏–Ω–∞—á–µ adb getprop)                                                                                                                  | auto                           |
| `APK_PATH`                | –ü—É—Ç—å –∫ .apk       | –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞–≤—Ç–æ-–ø–æ–∏—Å–∫ apk                                                                                                                           | –∞–≤—Ç–æ-–ø–æ–∏—Å–∫ –≤ ./apps            |
| `FULL_RESET`              | `true/false`      | –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è                                                                                                                                 | false (noReset)                |
| `APP_PACKAGE`             | app package       | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ real device launch                                                                                                                     | com.fin.whiteswan              |
| `APP_ACTIVITY`            | activity          | –°—Ç–∞—Ä—Ç–æ–≤–∞—è Activity                                                                                                                                      | com.fin.whiteswan.MainActivity |
| `APP_WAIT_ACTIVITY`       | activity          | –ñ–¥–µ–º Activity –Ω–∞ —ç–º—É–ª—è—Ç–æ—Ä–µ                                                                                                                              | MainActivity                   |
| `APPIUM_PORT`             | —á–∏—Å–ª–æ             | –ü–æ—Ä—Ç Appium —Å–µ—Ä–≤–µ—Ä–∞                                                                                                                                     | 4724                           |
| `APPIUM_HOST`             | host              | –•–æ—Å—Ç Appium                                                                                                                                             | localhost / 0.0.0.0 (CI)       |
| `KEEP_APP`                | `true/false`      | –ù–µ —É–¥–∞–ª—è—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ afterSession                                                                                                                    | false                          |
| `ENABLE_VIDEO_REPORTER`   | `true/false`      | –ü–æ–¥–∫–ª—é—á–∏—Ç—å `wdio-video-reporter`                                                                                                                        | false                          |
| `DISABLE_NATIVE_VIDEO`    | `true/false`      | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Appium screen recording                                                                                                                 | false                          |
| `ALWAYS_ATTACH_VIDEO`     | `true/false`      | –ü—Ä–∏–∫—Ä–µ–ø–ª—è—Ç—å –≤–∏–¥–µ–æ –¥–∞–∂–µ –¥–ª—è passed —Ç–µ—Å—Ç–æ–≤                                                                                                                | false                          |
| `SCREENSHOT_ON_PASS`      | `true/false`      | –°–∫—Ä–∏–Ω—à–æ—Ç –¥–ª—è —É—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤                                                                                                                            | false                          |
| `LOGS_ON_PASS`            | `true/false`      | logcat tail –¥–ª—è passed —Ç–µ—Å—Ç–æ–≤                                                                                                                           | false                          |
| `CLEAR_LOGCAT`            | `true/false`      | –û—á–∏—â–∞—Ç—å logcat –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–æ–º                                                                                                                             | true                           |
| `VERBOSE_CMDS`            | `true/false`      | –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ —à–∞–≥–∏ WebDriver (findElement, click, isDisplayed, –∞–≤—Ç–æ-—Å–∫—Ä–∏–Ω—à–æ—Ç—ã). –ü—Ä–∏ false –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–∞—à–∏ –±–∏–∑–Ω–µ—Å-—à–∞–≥–∏ (step(...)). | false                          |
| `MEMINFO_LINES`           | —á–∏—Å–ª–æ             | –°–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ meminfo –ø—Ä–∏–∫—Ä–µ–ø–ª—è—Ç—å (–ø–∞—Ä—Å–∏—Ç—Å—è –∫–ª—é—á–µ–≤—ã–µ —Å–µ–∫—Ü–∏–∏ + fallback)                                                                                 | 120                            |
| `INLINE_STEP_SCREENSHOTS` | `true/false`      | –í—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç –≤–Ω—É—Ç—Ä—å –∫–∞–∂–¥–æ–≥–æ –±–∏–∑–Ω–µ—Å‚Äë—à–∞–≥–∞ (—á–µ—Ä–µ–∑ helper `stepSS`). –ü—Ä–∏ `false` –¥–µ–ª–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–µ –≤–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ attachScreenshot.                 | true                           |
| `STEP_NUMBERING`          | `true/false`      | –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ-–Ω—É–º–µ—Ä–∞—Ü–∏—é —à–∞–≥–æ–≤ (1., 2., 3.) –≤ `stepSS`. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–∫–ª—é—á–µ–Ω–æ.                                                                          | false                          |
| `ENHANCED_DEBUG`          | `true/false`      | –í–∫–ª—é—á–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è —É–ø–∞–≤—à–∏—Ö —Ç–µ—Å—Ç–æ–≤ (UI Hierarchy, —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏, —Å–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)                                  | true                           |
| `RECOVER_PREV_FAIL`       | `true/false`      | –í–∫–ª—é—á–∞–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –µ—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–µ—Å—Ç —É–ø–∞–ª                                                                                      | true                           |
| `RECOVER_WAIT_MS`         | —á–∏—Å–ª–æ             | –î–æ–ø. –ø–∞—É–∑–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (ms)                                                                                                            | 0                              |
| `RECOVER_STRATEGY`        | enum              | –°—Ç—Ä–∞—Ç–µ–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ —É–ø–∞–≤—à–µ–≥–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Ç–µ—Å—Ç–∞: `restart` / `clear-data` / `reinstall`                                                       | clear-data                     |
| `RECOVER_FORCE_REINSTALL` | `true/false`      | –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∏ –≤—Å–µ–≥–¥–∞ –¥–µ–ª–∞—Ç—å –ø–æ–ª–Ω—É—é –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫—É –ø–æ—Å–ª–µ –ø–∞–¥–µ–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Ç–µ—Å—Ç–∞                                                             | false                          |
| `TEST_DB_VERSION`         | —Å—Ç—Ä–æ–∫–∞            | –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ environment.properties                                                                                                                    | N/A                            |
| `TEST_USER`               | —Å—Ç—Ä–æ–∫–∞            | –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ environment.properties                                                                                                                    | N/A                            |
| `CI`                      | (–ª—é–±–æ–µ)           | –í–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º CI (hostname 0.0.0.0, retries=1)                                                                                                         | -                              |
| `JENKINS_URL`             | URL               | –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ CI                                                                                                                                 | -                              |
| `FORCED_UNICODE_IME`      | `true/false`      | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á–∏—Ç—å unicodeKeyboard (IME) –¥–∞–∂–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ (–º–æ–∂–µ—Ç –ø–∞–¥–∞—Ç—å —Å SecurityException –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–æ—à–∏–≤–∫–∞—Ö)                      | false                          |

## –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã Allure

–ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Ç–µ—Å—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–∫—Ä–µ–ø–ª—è—é—Ç—Å—è:

- –°–∫—Ä–∏–Ω—à–æ—Ç
- –í–∏–¥–µ–æ (native screen recording –∏–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ñ–∞–π–ª video reporter)
- logcat (tail 500)
- dumpsys meminfo (–ø–µ—Ä–≤—ã–µ —Å—Ç—Ä–æ–∫–∏)
- Failure meta (–∫—Ä–∞—Ç–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ)
- Raw afterTest payload (–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞)
- **üîç –ü–æ–ª–Ω–∞—è –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** (—Å–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
- **üì± UI Hierarchy (XML)** (–ø–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —ç–∫—Ä–∞–Ω–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç –æ—à–∏–±–∫–∏)
- **üìã –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ)** (—Ç–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)

> –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `ENHANCED_DEBUG=true/false` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω–∞). –ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. [DEBUG_INFO.md](./DEBUG_INFO.md).

–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (ENV):

- –í–∏–¥–µ–æ –¥–ª—è passed —Ç–µ—Å—Ç–æ–≤ (`ALWAYS_ATTACH_VIDEO=true`)
- –°–∫—Ä–∏–Ω—à–æ—Ç –¥–ª—è passed (`SCREENSHOT_ON_PASS=true`)
- logcat tail (200) –¥–ª—è passed (`LOGS_ON_PASS=true`)
- Inline —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –≤ —à–∞–≥–∞—Ö (`INLINE_STEP_SCREENSHOTS=true` ‚Äî –≤–∫–ª—é—á–µ–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

## –õ–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ APK

–ë–µ—Ä—ë—Ç—Å—è –Ω–∞–∏–±–æ–ª–µ–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `./apps`, –∏–º—è –∫–æ—Ç–æ—Ä–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —à–∞–±–ª–æ–Ω—É `(build-|app-|release|debug).*\.apk`. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ ‚Äî fallback `my-app.apk`.

## –í–∏–¥–µ–æ

–î–≤–∞ –º–µ—Ö–∞–Ω–∏–∑–º–∞ (–≤–∑–∞–∏–º–æ–¥–æ–ø–æ–ª–Ω—è—é—â–∏–µ):

1. Native Appium (`startRecordingScreen` / `stopRecordingScreen`).
2. `wdio-video-reporter` (–≤–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `ENABLE_VIDEO_REPORTER=true`).

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –≤ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–π –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–µ.

## –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏–µ

–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π –ø–æ lifecycle —Ç–µ–ø–µ—Ä—å —Ç–∞–∫–∞—è:

1. –í –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞ (beforeTest) –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è recovery (–µ—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–µ—Å—Ç –ø–∞–¥–∞–ª) ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫/–∞–∫—Ç–∏–≤–∞—Ü–∏—è.
2. –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞ (afterTest) —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –∏ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å (—É—Å–ø–µ—Ö/–ø—Ä–æ–≤–∞–ª).
3. –ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–µ—Å—Å–∏–∏ WebDriver (afterSession):

- –ï—Å–ª–∏ `KEEP_APP=true` ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è (–¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–Ω—ã—Ö –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∏—Ç–µ—Ä–∞—Ü–∏–π).
- –ò–Ω–∞—á–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —à—Ç–∞—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ + —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `removeApp`.

4. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ–≥–æ —Ä–∞–Ω–Ω–µ—Ä–∞ (onComplete) –≤—Å–µ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ `adb uninstall <package>` ‚Äî –¥–∞–∂–µ –µ—Å–ª–∏ –±—ã–ª `KEEP_APP=true` –∏–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ –≤ `afterSession`.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –Ω–æ–≤—ã–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤—Å–µ–≥–¥–∞ —Å—Ç–∞—Ä—Ç—É–µ—Ç "—Å –Ω—É–ª—è" (—á–∏—Å—Ç–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞), –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, —á–µ–º –∑–∞–∫–æ–Ω—á–∏–ª—Å—è –ø—Ä–æ—à–ª—ã–π –ø—Ä–æ–≥–æ–Ω.

–û—Ç–∫–ª—é—á–∏—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–ª—å–∑—è (–ø—Ä–µ–¥–Ω–∞–º–µ—Ä–µ–Ω–Ω–æ), –Ω–æ –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –¥—Ä—É–≥–æ–π –ø–∞–∫–µ—Ç —á–µ—Ä–µ–∑ `APP_PACKAGE`.

## –ë–∏–∑–Ω–µ—Å‚Äë—à–∞–≥–∏ –∏ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã

–î–ª—è –ª–∞–∫–æ–Ω–∏—á–Ω—ã—Ö Allure –æ—Ç—á—ë—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π helper `stepSS` (–ø–æ–≤–µ—Ä—Ö –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–≥–æ `runStep`). –û–Ω –¥–∞—ë—Ç:

- –ê–≤—Ç–æ-–Ω—É–º–µ—Ä–∞—Ü–∏—é —à–∞–≥–æ–≤ –≤–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–≥–æ `it` (1., 2., 3. ...).
- –ö–æ—Ä–æ—Ç–∫–∏–µ —á–µ–ª–æ–≤–µ–∫–æ‚Äë—á–∏—Ç–∞–µ–º—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤.
- Inline —Å–∫—Ä–∏–Ω—à–æ—Ç (–µ—Å–ª–∏ `INLINE_STEP_SCREENSHOTS !== 'false'`).
- Fallback —è–≤–Ω—ã–π —Å–∫—Ä–∏–Ω—à–æ—Ç —á–µ—Ä–µ–∑ `attachScreenshot` –µ—Å–ª–∏ inline –≤—ã–∫–ª—é—á–µ–Ω.

### –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–∏–º–µ—Ä

```ts
import { stepSS } from '../utils/stepHelper';

it('Login flow', async () => {
  await stepSS('–û—Ç–∫—Ä—ã—Ç—å –ª–æ–≥–∏–Ω', async () => {
    await LoginPage.open();
  });
  await stepSS('–í–≤–µ—Å—Ç–∏ —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ', async () => {
    await LoginPage.login(user, pass);
  });
  await stepSS('–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞—à–±–æ—Ä–¥', async () => {
    await DashboardPage.assertVisible();
  });
});
```

### –û–ø—Ü–∏–∏ `stepSS`

```ts
await stepSS(
  '–ù–∞–∑–≤–∞–Ω–∏–µ',
  async () => {
    /* –¥–µ–π—Å—Ç–≤–∏—è */
  },
  {
    forceScreenshot: false, // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∫ inline (–∏–ª–∏ –∫–æ–≥–¥–∞ inline –æ—Ç–∫–ª—é—á—ë–Ω)
    noNumber: false, // –ù–µ –¥–æ–±–∞–≤–ª—è—Ç—å –∞–≤—Ç–æ-–ø—Ä–µ—Ñ–∏–∫—Å "1. " —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–≥–æ —à–∞–≥–∞
    customLabel: undefined, // –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏—Ç–æ–≥–æ–≤—ã–π —Ç–µ–∫—Å—Ç —à–∞–≥–∞ (–æ—Ç–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ-–Ω—É–º–µ—Ä–∞—Ü–∏—é –µ—Å–ª–∏ –∑–∞–¥–∞–Ω)
  },
);
```

–ü–æ–≤–µ–¥–µ–Ω–∏–µ:

- –ï—Å–ª–∏ `INLINE_STEP_SCREENSHOTS=true` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) ‚Äî –≤–Ω—É—Ç—Ä–∏ Allure —à–∞–≥–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–Ω—à–æ—Ç.
- –ï—Å–ª–∏ –≤—ã–∫–ª—é—á–∏—Ç—å (`INLINE_STEP_SCREENSHOTS=false`) ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å: —à–∞–≥ –±–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è + –æ—Ç–¥–µ–ª—å–Ω–æ–µ –≤–ª–æ–∂–µ–Ω–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞.
- `forceScreenshot: true` –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –¥–∞–∂–µ –ø—Ä–∏ inline —Ä–µ–∂–∏–º–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –¥–æ/–ø–æ—Å–ª–µ).

### –°–±—Ä–æ—Å —Å—á—ë—Ç—á–∏–∫–∞

–°—á—ë—Ç—á–∏–∫ —à–∞–≥–æ–≤ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `beforeEach(resetStepCounter())`. –ï—Å–ª–∏ –Ω—É–∂–µ–Ω —Ä—É—á–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å ‚Äî –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ `resetStepCounter`.

### –ù–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π helper `runStep`

`runStep(label, fn)` ‚Äî –±–∞–∑–æ–≤–∞—è –æ–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ Allure `startStep / endStep`, –∏—Å–ø–æ–ª—å–∑—É—é—â–∞—è—Å—è –≤–Ω—É—Ç—Ä–∏ `stepSS`. –ú–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é –¥–ª—è –æ—Å–æ–±—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –±–µ–∑ –∞–≤—Ç–æ-–Ω—É–º–µ—Ä–∞—Ü–∏–∏.

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ENV, –≤–ª–∏—è—é—â–∏–µ –Ω–∞ —Ä–µ–ø–æ—Ä—Ç

| –§–ª–∞–≥                           | –í–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ                                                                 |
| ------------------------------ | --------------------------------------------------------------------------- |
| `VERBOSE_CMDS=false`           | –°–∫—Ä—ã–≤–∞–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —à–∞–≥–∏ WebDriverIO, –æ—Å—Ç–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –±–∏–∑–Ω–µ—Å‚Äë—à–∞–≥–∏ `stepSS` |
| `INLINE_STEP_SCREENSHOTS=true` | –í—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç –≤ —Å–∞–º —à–∞–≥ (–º–∏–Ω–∏–º—É–º —à—É–º–∞)                                |
| `SCREENSHOT_ON_PASS=true`      | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–Ω—à–æ—Ç –ø—Ä–∏ —É—Å–ø–µ—Ö–µ —Ç–µ—Å—Ç–∞ (–ø–æ—Å–ª–µ –≤—Å–µ—Ö —à–∞–≥–æ–≤)       |
| `ALWAYS_ATTACH_VIDEO=true`     | –í–∏–¥–µ–æ –≤—Å–µ–≥–¥–∞, –¥–∞–∂–µ –µ—Å–ª–∏ —Ç–µ—Å—Ç passed                                         |

–ö–æ–º–±–∏–Ω–∏—Ä—É—è —Ñ–ª–∞–≥–∏ –º–æ–∂–Ω–æ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –º–µ–∂–¥—É –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏ –ª–∞–∫–æ–Ω–∏—á–Ω–æ—Å—Ç—å—é –æ—Ç—á—ë—Ç–∞.

## –°–æ–≤–µ—Ç—ã –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ

1. –ï—Å–ª–∏ –Ω–µ—Ç –≤–ª–æ–∂–µ–Ω–∏–π –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ ‚Äî –ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `afterTest` (–≤ –ª–æ–≥–µ –µ—Å—Ç—å `[afterTest] test="..."`).
2. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –Ω–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ try/catch, —Å–∫—Ä—ã–≤–∞—é—â–µ–≥–æ –æ—à–∏–±–∫—É –≤–Ω—É—Ç—Ä–∏ —à–∞–≥–∞.
3. –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –¥–æ–±–∞–≤—å –∑–∞–¥–µ—Ä–∂–∫—É –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏, –µ—Å–ª–∏ –≤–∏–¥–µ–æ –ø—É—Å—Ç–æ–µ.
4. –ü—Ä–∏ –±–æ–ª—å—à–æ–º logcat –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å `-t 500` –∏–ª–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ —Ç–µ–≥–∞–º.
5. –ï—Å–ª–∏ –≤ –æ—Ç—á—ë—Ç–µ –≤–∏–¥–Ω–æ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —à–∞–≥–æ–≤ (`findElement`, `isElementDisplayed`, `takeScreenshot` –∏ —Ç.–ø.) ‚Äî –≤—ã–∫–ª—é—á–∏ –∏—Ö —á–µ—Ä–µ–∑ `VERBOSE_CMDS=false` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —É–∂–µ —Å–∫—Ä—ã—Ç—ã). –í–∫–ª—é—á–∞–π `VERBOSE_CMDS=true` —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.

## TODO / –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

- –í—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π helper.
- –î–æ–±–∞–≤–∏—Ç—å —Å–±–æ—Ä performance metrics —á–µ—Ä–µ–∑ `adb shell top -b -n 1`.
- –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –æ—Ç—á—ë—Ç–∞ –≤ Telegram/Slack.
- –†–∞—Å—à–∏—Ä–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: `auto` (—ç–≤—Ä–∏—Å—Ç–∏–∫–∞: –µ—Å–ª–∏ –≤—Ç–æ—Ä–æ–π –ø–æ–¥—Ä—è–¥ —Ñ–µ–π–ª ‚Üí clear-data, –µ—Å–ª–∏ —Å–Ω–æ–≤–∞ ‚Üí reinstall); `backstack` (–Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–∞–∂–∞—Ç–∏–π back –≤–º–µ—Å—Ç–æ –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö).
  - `auto`: –±—É–¥–µ—Ç —Å—á–∏—Ç–∞—Ç—å —á–∏—Å–ª–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–∞–¥–µ–Ω–∏–π. 1-–π ‚Üí restart, 2-–π ‚Üí clear-data, 3-–π –∏ –¥–∞–ª–µ–µ ‚Üí reinstall (—Å–±—Ä–æ—Å —Å—á—ë—Ç—á–∏–∫–∞ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —Ç–µ—Å—Ç–µ).
  - `backstack`: –º—è–≥–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî N –Ω–∞–∂–∞—Ç–∏–π –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–π –∫–Ω–æ–ø–∫–∏ Back (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–π –ª–∏–º–∏—Ç), –µ—Å–ª–∏ –æ—Å—Ç–∞—ë–º—Å—è –Ω–µ –Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤–æ–º —ç–∫—Ä–∞–Ω–µ ‚Üí fallback –∫ restart.

---

### –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (RECOVER_STRATEGY)

–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `RECOVER_STRATEGY` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞–∫ –º—ã ¬´—á–∏—Å—Ç–∏–º¬ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ç–µ—Å—Ç–∞, –µ—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —É–ø–∞–ª.

| –ó–Ω–∞—á–µ–Ω–∏–µ                 | –î–µ–π—Å—Ç–≤–∏—è                                                                      | –ü–ª—é—Å—ã                                | –ú–∏–Ω—É—Å—ã / –†–∏—Å–∫–∏                                     |
| ------------------------ | ----------------------------------------------------------------------------- | ------------------------------------ | -------------------------------------------------- |
| `clear-data` (–ø–æ —É–º–æ–ª—á.) | pm clear <package> ‚Üí activateApp                                              | –í—Å–µ–≥–¥–∞ —á–∏—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ              | –¢–µ—Ä—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ/–∫–µ—à, —á—É—Ç—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ      |
| `restart`                | terminateApp ‚Üí pause ‚Üí activateApp (fallback launchApp, fallback install apk) | –ë—ã—Å—Ç—Ä–æ                               | –ú–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –Ω–∞ —Ç–æ—Ç –∂–µ —ç–∫—Ä–∞–Ω / —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è |
| `reinstall`              | removeApp ‚Üí installApp (apk) ‚Üí activateApp                                    | –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ + —á–∏—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ | –°–∞–º–æ–µ –º–µ–¥–ª–µ–Ω–Ω–æ–µ; –Ω—É–∂–µ–Ω apk –∏ –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏        |

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —É–∂–µ –≤–∫–ª—é—á—ë–Ω `clear-data` ‚Äî –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —á–∏—Å—Ç—ã–π —Å—Ç–∞—Ä—Ç.
2. –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —É—Å–∫–æ—Ä–∏—Ç—å –ø—Ä–æ–≥–æ–Ω –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–∞–º–æ ¬´–æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è¬ª ‚Äî –∑–∞–¥–∞–π—Ç–µ `RECOVER_STRATEGY=restart`.
3. –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã/–ø–æ–ª–æ–º–∫—É –ø–æ—Å–ª–µ —Å–µ—Ä–∏–∏ –ø–∞–¥–µ–Ω–∏–π ‚Äî –≤—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `reinstall`.

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –º–æ–∂–Ω–æ —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ —á–µ—Ä–µ–∑ `RECOVER_WAIT_MS` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `RECOVER_WAIT_MS=2000`).

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞ c –æ—á–∏—Å—Ç–∫–æ–π –¥–∞–Ω–Ω—ã—Ö:

```
RECOVER_STRATEGY=clear-data npm run test:ci
```

–ß—Ç–æ–±—ã —è–≤–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≥–ª–∞–≤–Ω—É—é Activity –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ (–µ—Å–ª–∏ `activateApp` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ —Ç–æ—Ç —ç–∫—Ä–∞–Ω), –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `RECOVER_MAIN_ACTIVITY`:

```
RECOVER_MAIN_ACTIVITY=com.fin.whiteswan.MainActivity RECOVER_STRATEGY=clear-data npm run test:ci
```

–¢–µ–∫—É—â–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è `clear-data` —Ç–µ–ø–µ—Ä—å:

1. `adb shell am force-stop <package>`
2. `adb shell pm clear <package>`
3. –ï—Å–ª–∏ –∑–∞–¥–∞–Ω–∞ `RECOVER_MAIN_ACTIVITY` –∏–ª–∏ `APP_ACTIVITY` ‚Äî `adb shell am start -n <package>/<Activity>`
4. –ò–Ω–∞—á–µ fallback `activateApp`
5. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ø–∞—É–∑–∞ `RECOVER_WAIT_MS`
6. –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è —Ç–µ–∫—É—â–∞—è activity (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)

–ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∏ (–Ω—É–∂–Ω–æ —á—Ç–æ–±—ã `APK_PATH` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É–∫–∞–∑—ã–≤–∞–ª –Ω–∞ apk):

```
RECOVER_STRATEGY=reinstall APK_PATH=./apps/build-latest.apk npm run test:ci
```

–ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –ª–æ–≥ –ø—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç –∏ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω `clear-data`.

---

–û–±–Ω–æ–≤–ª—è–π ENV –ø–æ–¥ —Å–≤–æ–∏ –Ω—É–∂–¥—ã; –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º —Ä–µ–ø–æ—Ä—Ç–∏–Ω–≥–æ–º ‚Äî –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Ö—É–∫–∏.

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

–õ–æ–≥–∏–∫–∞ –∞–≤—Ç–æ–¥–µ—Ç–µ–∫—Ç–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Ç–µ–ø–µ—Ä—å —Ç–∞–∫–∞—è:

1. –ï—Å–ª–∏ `REAL_DEVICE=true` –∏–ª–∏ `FORCED_UNICODE_IME=true` ‚Äî –ø—Ä–æ–±—É–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ (–ø–æ UDID –∏–ª–∏ –ø–µ—Ä–≤–æ–º—É –¥–æ—Å—Ç—É–ø–Ω–æ–º—É).
2. –ò–Ω–∞—á–µ ‚Äî —ç–º—É–ª—è—Ç–æ—Ä (–ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ –ø–µ—Ä–≤–æ–º—É –¥–æ—Å—Ç—É–ø–Ω–æ–º—É).

### IME / unicodeKeyboard –ø–æ–≤–µ–¥–µ–Ω–∏–µ

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `unicodeKeyboard` –∞–∫—Ç–∏–≤–µ–Ω –¢–û–õ–¨–ö–û –Ω–∞ —ç–º—É–ª—è—Ç–æ—Ä–∞—Ö, —Ç.–∫. –Ω–∞ —Ä—è–¥–µ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤–∫–ª—é—á–µ–Ω–∏–µ `io.appium.settings/.UnicodeIME` –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ—à–∏–±–∫–µ `SecurityException: uid 2000 does not have android.permission.WRITE_SECURE_SETTINGS`.

–ï—Å–ª–∏ –≤–∞–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω—É–∂–µ–Ω `unicodeKeyboard` –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –¥–µ–≤–∞–π—Å–µ (—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Ä—É—Ç–æ–≤–∞–Ω–æ –∏–ª–∏ –ø–æ–ª–∏—Ç–∏–∫–∞ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç) ‚Äî –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å:

```
FORCED_UNICODE_IME=true REAL_DEVICE=true npm run test:local
```

–ü—Ä–∏ —ç—Ç–æ–º –≤ capabilities –±—É–¥–µ—Ç –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–æ `unicodeKeyboard=true` –∏ `resetKeyboard=true`.
